<!DOCTYPE html>
<html>
<head>	
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>Twlyr - Share a Song!</title>

	<link href="bootstrap/css/bootstrap.css" rel="stylesheet"></link>
	<link href='main.css' rel='stylesheet' type='text/css'>
	<link href='http://fonts.googleapis.com/css?family=Berkshire+Swash|Courgette|Open+Sans' rel='stylesheet' type='text/css'>

	<script src="js/jquery.min.js"></script>
	<script src="js/bootstrap.min.js"></script>

	<script src="js/vagalume.js" charset="utf-8"></script>
	<script src="js/boxes.js" charset="utf-8"></script>
	<script src="js/mustache.js"></script>

	<style>

	.wrap-left {
		width: 380px;
		float: left;
		padding-right: 20px;
	}

	.wrap-right {
		float: right;
		width: 400px;
	}
	
	.boing {
		margin: 200px 0;
	}

	/* overwrite bootstrap's .container */
	.container.black {
		width: auto;
		left: 0; right: 0;
		margin-top: 20px;
		background: #777;
		background: url(images/blackbg.png);
		box-shadow: inset 0 10px 40px -10px black;
	}
	.container.black {
		border-top: 3px dotted white;
	}

	.box-wrapper:not(:empty) {
		margin: 0 auto;
		padding: 40px 0;
		width: 800px;
	}

	.music-info-wrapper > * {
		display: inline-block;
		color: #222;
		font: 14px/20px "Open Sans";
	}

	.music-info-wrapper img {
		margin-right: 20px;
		vertical-align: top;
		box-shadow: 0 0 4px black;
	}

	.box-wrapper h2 {
		margin-bottom: 30px;
	}

	</style>

</head>
<body>

<div class="beta-strip">Beta v1.0</div>

<div class="container">
	<div class="boing">
		<h1 class="twlyr">Twlyr</h1>
		<h3 class="desc">share a verse on Twitter!</h3>
		
		<div id="searchbar">
			<form class="form-search">
				<input type="text" autocomplete="off" placeholder="choose an artist" class="input-medium search-query" id="search-artist">
				<input type="text" autocomplete="off" placeholder="choose a song" class="input-medium search-query" id="search-music">
				<button type="submit" class="btn btn-warning btn-large">Search</button>
			</form>
		</div>
	<footer>
		2012 &reg created by <a href="http://twitter.com/#!/f03lipe">@f03lipe</a> and <a href="http://twitter.com/#!/gabriel_vianna">@gabrielvianna</a>
	</footer>
	</div>

</div>

<div class="container black">
	<div class="box-wrapper"></div>
</div>

<!--
<script src="js/index.js"></script>
-->

<script id="lyrics-box-html" type="text/html">

	<h2>Hey, we found something!</h2>

	<div class="box lyrics-box">
		<div class="wrap-left">
			<div class="music-info-wrapper" style="margin-bottom: 20px">
				<img src="{{pic-url}}"></img>
				<div>
					artist: <h3 class="artist-name">{{artist-name}}</h3>
					song: <h3 class="song-name">{{song-name}}</h3>
				</div>
			</div>


			<div class="tweet-box">
				<textarea class="tweet" placeholder="select the lyrics on the right to tweet..."></textarea>

				<div class="align-line">
					<div class="twtcounter">0</div>
					<button class="btn btn-success tweet-button" onClick="openTweetPopup()">Tweet</button>
				</div>
			</div>
		</div>
		<div class="wrap-right">
			<h5>{{artist-name}}'s {{song-name}} lyrics:</h5> <!--' -->
			<div class="lyrics"></div>
		</div>
	</div>

</script>

<script>

SearchBar = new SearchBar();

//////////////////

// format: #!<artist>:<song>
// undefined songs: #!<artist>:?
// undefined artists: #!:<song>
// searches have no urls
// errors: #!error

String.prototype.capitalize = function () {
    return String(this).replace( /(^|\s)([a-z])/g , function (m, p1, p2) {
        return p1 + p2.toUpperCase();
    });
};


////////////////////////////

document.querySelector("form.form-search").onsubmit = function () {
	var artist = document.querySelector("#search-artist").value.toLowerCase().trim(),
		music = document.querySelector("#search-music").value.toLowerCase().trim();
	location.hash = "#!"+escape(artist)+":"+escape(music);
	/* do this
	if (history && history.pushState)
		history.pushState({module:"leave"}, document.title, this.href);
	*/
	decideOnHash({artist:artist, music:music});
    (function scrollToContent() { // reciclar
		var p = document.querySelector(".box-wrapper").offsetTop;
		$('html').animate({scrollTop:p}, 1000); // IE, FF
		$('body').animate({scrollTop:p}, 1000); // chrome, don't know if safary works
	})()
	return false
}

function updateForm (hashObj) {
	document.querySelector("#search-artist").value = hashObj.artist;
	document.querySelector("#search-music").value = hashObj.music;
}

function parseHash (hashUrl) {
	// Return {String artist, String music} based on location.hash.
	var hash = hashUrl || location.hash.replace(/^#\!?/, ''); // remove #! from beginning
	if (hash === 'error')
		// Remember to take down website they come up with an artist named 'error'.
		return {artist: null, music: null, error: true}
	var artist = unescape(hash.split(':')[0] || '').capitalize(),
		music = unescape(hash.split(':')[1] || '').capitalize();
	return {artist: artist, music: music}
}

function decideOnHash (hashObj) {
	// Decide what to do, based hashObj {String artist, String music}
	if (hashObj.error) {
		console.log('error')
	} else if (hashObj.artist && hashObj.music) {
		lb = new LyricsBox(hashObj.artist, hashObj.music);
	}
}

(function () {
	var h = parseHash();
	updateForm(h)
	decideOnHash(parseHash())
})();

</script>

</body>
</html>