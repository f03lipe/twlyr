<!DOCTYPE html>
<html>
<head>	
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>Twlyr - Share a Song!</title>

	<link href="bootstrap/css/bootstrap.css" rel="stylesheet"></link>
	<link href='main.css' rel='stylesheet' type='text/css'>
	<link href='http://fonts.googleapis.com/css?family=Berkshire+Swash|Courgette|Open+Sans' rel='stylesheet' type='text/css'>

	<script src="js/jquery.min.js"></script>
	<script src="js/vagalume.js" charset="utf-8"></script>
	<script src="js/lyrics.js" charset="utf-8"></script>
	<script src="js/selector.js" charset="utf-8"></script>

	<style>

	.box.left {
		width: 380px;
		float: left;
		padding: 10px 0;
	}

	.box.right {
		float: right;
		width: 400px;
	}

	</style>

	<style>
	.container { margin-top: 50px; }
	</style>

</head>
<body>


<div class="container">

	<div class="inline-search-bar">
		<div class="twlyr medium">Twlyr</div>
		<div id="searchbar">
			<form class="form-search">
				<input type="text" placeholder="choose an artist" class="input-medium search-query" id="search-artist">
				<input type="text" placeholder="choose a song" class="input-medium search-query" id="search-music">
				<button type="submit" class="btn btn-warning btn-large">Search</button>
			</form>
		</div>
	</div>
	
	<div id="content">
	</div>

</div>

<!--
<script src="js/index.js"></script>
-->



<script id="lyrics-box-html" type="text/html">
	<div id="lyrics-box">
		<div class="box left">
			<h4 id="artist-name"></h4>
			<h4 id="music-name"></h4>
			
			<br>

			<div class="tweet-box">
				<textarea id="tweet"></textarea>

				<div class="align-line">
					<div class="twtcounter">0</div>
					<button class="btn btn-success" id="tweet-button" onClick="openTweetPopup()">Tweet</button>
				</div>
			</div>
		</div>
		<div class="box right">
			<div class="lyrics"></div>
		</div>
	</div>
</script>

<script>

// format: #!<artist>:<song>
// undefined songs: #!<artist>:?
// undefined artists: #!:<song>
// searches have no urls
// errors: #!error

String.prototype.capitalize = function () {
    return String(this).replace( /(^|\s)([a-z])/g , function (m, p1, p2) {
        return p1 + p2.toUpperCase();
    });
};

$$ = function () {
    return document.querySelectorAll.apply(document, arguments);
}

////////////////////////////

function search () {

}

document.querySelector("form.form-search").onsubmit = function () {
	var artist = document.querySelector("#search-artist").value.toLowerCase().trim(),
		music = document.querySelector("#search-music").value.toLowerCase().trim();
	location.hash = "#!"+escape(artist)+":"+escape(music);
	/* do this
	if (history && history.pushState)
		history.pushState({module:"leave"}, document.title, this.href);
	*/
	decideOnHash({artist:artist, music:music});
	return false
}

function updateForm (hashObj) {
	document.querySelector("#search-artist").value = hashObj.artist;
	document.querySelector("#search-music").value = hashObj.music;
}

function parseHash (hashUrl) {
	// Return {String artist, String music} based on location.hash.
	var hash = hashUrl || location.hash.replace(/^#\!?/, ''); // remove #! from beginning
	if (hash === 'error')
		// Remember to take down website they come up with an artist named 'error'.
		return {artist: null, music: null, error: true}
	var artist = unescape(hash.split(':')[0] || '').capitalize(),
		music = unescape(hash.split(':')[1] || '').capitalize();
	return {artist: artist, music: music}
}

function decideOnHash (hashObj) {
	// Decide what to do, based hashObj {String artist, String music}
	if (hashObj.error) {
		console.log('error')
	} else if (hashObj.artist && hashObj.music) {
		lb = new LyricsBox(hashObj.artist, hashObj.music);
	}
}

(function () {
	var h = parseHash();
	updateForm(h)
	decideOnHash(parseHash())
})();

</script>

</body>
</html>